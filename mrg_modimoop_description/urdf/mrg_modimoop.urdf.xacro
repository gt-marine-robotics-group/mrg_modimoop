<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from /root/mrg_ws/install/share/mrg_modimoop/urdf/mrg_modimoop.urdf.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<!-- Basic MODIMOOP description -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="MODIMOOP">

  <!-- ===================== -->
  <!-- Common parameters     -->
  <!-- ===================== -->
  <xacro:property name="mesh_scale" value="0.001 0.001 0.001"/>
  <!-- Rough masses (kg). Replace with measured values -->
  <xacro:property name="m_hull"     value="40.0"/>
  <xacro:property name="m_keel"     value="12.0"/>        <!-- total for keel (plate+bulb) if single link -->
  <xacro:property name="m_wingsail" value="6.0"/>
  <xacro:property name="m_rudder"   value="2.0"/>

  <!-- Simple diagonal inertias (kg·m²). Replace with real inertias -->
  <xacro:property name="I_small" value="0.02"/>

  <!-- Materials -->
  <material name="Grey"><color rgba="0.6 0.6 0.6 1.0"/></material>
  <material name="Blue"><color rgba="0.2 0.4 0.8 1.0"/></material>
  <material name="Red"><color rgba="0.8 0.2 0.2 1.0"/></material>
  <material name="Black"><color rgba="0.05 0.05 0.05 1.0"/></material>

  <!-- ===================== -->
  <!-- Links                 -->
  <!-- ===================== -->

  <!-- Hull is the base -->
  <link name="hull">
    <inertial>
      <origin xyz="0.175 -0.55 0.45" rpy="1.570796 0 0"/>
      <mass value="${m_hull}"/>
      <inertia ixx="0.8" ixy="0.0" ixz="0.0" iyy="1.2" iyz="0.0" izz="1.6"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/hull/hull.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/hull/hull.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Keel as a single link with two mesh components (plate + bulb) -->
  <link name="keel">
    <inertial>
      <!-- Set the CoM where you expect the keel COM; adjust for your CAD -->
      <origin xyz="0.175 -0.55 0.1" rpy="1.570796 0 0"/>
      <mass value="${m_keel}"/>
      <inertia ixx="${I_small}" ixy="0.0" ixz="0.0" iyy="${I_small}" iyz="0.0" izz="${I_small}"/>
    </inertial>

    <!-- Plate visual -->
    <visual>
      <!-- Align to plate’s CAD frame relative to keel link frame -->
      <origin xyz="0.175 -0.7 0.44" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>

    <!-- Bulb visual -->
    <visual>
      <!-- Align bulb mesh relative to keel link frame -->
      <origin xyz="0.135 -0.21 0.015" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>

    <!-- Plate collision -->
    <collision>
      <origin xyz="0.175 -0.7 0.44" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>

    <!-- Bulb collision -->
    <collision>
      <origin xyz="0.135 -0.21 0.015" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Wingsail (revolute about vertical axis for trim) -->
  <link name="wingsail">
    <inertial>
      <origin xyz="0.125 0.034 0.5" rpy="0 0 0"/>
      <mass value="${m_wingsail}"/>
      <inertia ixx="${I_small}" ixy="0.0" ixz="0.0" iyy="${I_small}" iyz="0.0" izz="${I_small}"/>
    </inertial>
    <visual>
      <origin xyz="-0.05 -0.015 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/mainsail/mainsail.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Red"/>
    </visual>
    <collision>
      <origin xyz="-0.05 -0.015 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/mainsail/mainsail.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Rudder (revolute about vertical axis) -->
  <link name="rudder">
    <inertial>
      <origin xyz="0 0.08 -0.08" rpy="0 0 0"/>
      <mass value="${m_rudder}"/>
      <inertia ixx="${I_small}" ixy="0.0" ixz="0.0" iyy="${I_small}" iyz="0.0" izz="${I_small}"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/rudder/rudder.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/rudder/rudder.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- ===================== -->
  <!-- Joints                -->
  <!-- ===================== -->

  <!-- Keel fixed to hull -->
  <!---->
  <joint name="keel_mount" type="fixed">
    <parent link="hull"/>
    <child link="keel"/>
    <!-- Place the keel under the hull; tune xyz/rpy to match CAD frames -->
    <origin xyz="0 0 -0.1" rpy="0 0 0"/>
  </joint>

  <!-- Wingsail rotates around Z (trim). Limit range ±90° by default -->
  <joint name="wingsail_joint" type="revolute">
    <parent link="hull"/>
    <child link="wingsail"/>
    <origin xyz="0.2 -0.65 0.65" rpy="0 0 1.570796"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="20.0" velocity="1.5"/>
    <dynamics damping="0.2" friction="0.0"/>
  </joint>

  <!-- Rudder rotates around Z for yaw -->
  <joint name="rudder_joint" type="revolute">
    <parent link="hull"/>
    <child link="rudder"/>
    <origin xyz="0.175 -0.3 0.3" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-0.7854" upper="0.7854" effort="10.0" velocity="2.0"/>
    <dynamics damping="0.1" friction="0.0"/>
  </joint>

  <!-- ========================================================= -->
  <!-- OPTIONAL: model plate + bulb as separate links (fixed)    -->
  <!-- Un-comment this block and remove the single-link keel     -->
  <!-- setup above if you want distinct masses/inertias.         -->
  
  <!--
  <link name="keel_plate">
    <inertial>
      <origin xyz="0 0 -0.15" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.02" iyz="0" izz="0.02"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.15" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.15" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>
  

  <link name="keel_bulb">
    <inertial>
      <origin xyz="0 0 -0.35" rpy="0 0 0"/>
      <mass value="7.0"/>
      <inertia ixx="0.02" ixy="0" ixz="0" iyy="0.03" iyz="0" izz="0.03"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.35" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.35" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <joint name="keel_plate_mount" type="fixed">
    <parent link="hull"/>
    <child link="keel_plate"/>
    <origin xyz="0 0 -0.1" rpy="0 0 0"/>
  </joint>

  <joint name="keel_bulb_fix" type="fixed">
    <parent link="keel_plate"/>
    <child link="keel_bulb"/>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>
  </joint>
  -->
  <!-- ========================================================= -->

  <!-- HYDRODYNAMICS for hull -->
  <!-- HYDRODYNAMICS for hull -->
  <gazebo>
    <plugin filename="gz-sim-hydrodynamics-system"
            name="gz::sim::systems::Hydrodynamics">
      <!-- required: which link carries this hydro model -->
      <link_name>hull</link_name>

      <!-- optional: fluid density (kg/m^3) -->
      <water_density>1025</water_density>

      <!-- Linear damping (1st-order) -->
      <xU>  400  </xU>   <!-- surge -->
      <yV>  800  </yV>   <!-- sway  -->
      <zW> 1500  </zW>   <!-- heave -->
      <kP>   50  </kP>   <!-- roll  -->
      <mQ>   50  </mQ>   <!-- pitch -->
      <nR>  120  </nR>   <!-- yaw   -->

      <!-- Quadratic damping with |vel| terms (2nd-order) -->
      <xUabsU>  80  </xUabsU>
      <yVabsV> 200  </yVabsV>
      <zWabsW> 380  </zWabsW>
      <kPabsP>  10  </kPabsP>
      <mQabsQ>  10  </mQabsQ>
      <nRabsR>  25  </nRabsR>

      <!-- (Deprecated) diagonal added mass — OK to leave at 0 to start -->
      <xDotU>  0  </xDotU>
      <yDotV>  0  </yDotV>
      <zDotW>  0  </zDotW>
      <kDotP>  0  </kDotP>
      <mDotQ>  0  </mDotQ>
      <nDotR>  0  </nDotR>
    </plugin>
  </gazebo>

  <!-- HYDRODYNAMICS for keel (single-link keel) -->
  <gazebo>
    <plugin filename="gz-sim-hydrodynamics-system"
            name="gz::sim::systems::Hydrodynamics">
      <link_name>keel</link_name>
      <water_density>1025</water_density>

      <!-- Keel is more “draggy” in heave / yaw; start with higher Z / yaw damping -->
      <xU>  200  </xU>
      <yV>  600  </yV>
      <zW> 2200  </zW>
      <kP>   40  </kP>
      <mQ>   40  </mQ>
      <nR>  200  </nR>

      <xUabsU>  50  </xUabsU>
      <yVabsV> 150  </yVabsV>
      <zWabsW> 500  </zWabsW>
      <kPabsP>   8  </kPabsP>
      <mQabsQ>   8  </mQabsQ>
      <nRabsR>  40  </nRabsR>
    </plugin>
  </gazebo>
</robot>

