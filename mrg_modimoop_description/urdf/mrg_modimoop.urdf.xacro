<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from /root/mrg_ws/install/share/mrg_modimoop/urdf/mrg_modimoop.urdf.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<!-- Basic MODIMOOP description -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="MODIMOOP">

  <!-- ===================== -->
  <!-- Common parameters     -->
  <!-- ===================== -->
  <xacro:property name="mesh_scale" value="0.001 0.001 0.001"/>
  <!-- Rough masses (kg). Replace with measured values -->
  <xacro:property name="m_hull"     value="20.0"/>
  <xacro:property name="m_keel"     value="3.0"/>        <!-- total for keel (plate+bulb) if single link -->
  <xacro:property name="m_wingsail" value="1.0"/>
  <xacro:property name="m_rudder"   value="0.1"/>

  <!-- Simple diagonal inertias (kg·m²). Replace with real inertias -->
  <xacro:property name="I_small" value="0.02"/>

  <!-- Materials -->
  <material name="Grey"><color rgba="0.6 0.6 0.6 1.0"/></material>
  <material name="Blue"><color rgba="0.2 0.4 0.8 1.0"/></material>
  <material name="Red"><color rgba="0.8 0.2 0.2 1.0"/></material>
  <material name="Black"><color rgba="0.05 0.05 0.05 1.0"/></material>

  <!-- ===================== -->
  <!-- Links                 -->
  <!-- ===================== -->

  <!-- Hull is the base -->
  <link name="hull">
    <inertial>
      <origin xyz="0.175 -0.55 0.45" rpy="1.570796 0 0"/>
      <mass value="${m_hull}"/>
      <inertia ixx="${m_hull*0.016}" ixy="0.0" ixz="${m_hull*0.016}" iyy="1.2" iyz="0.0" izz="${m_hull*0.016}"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/hull/hull.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/hull/hull.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Wingsail (revolute about vertical axis for trim) -->
  <link name="wingsail">
    <inertial>
      <origin xyz="0.125 0.034 0.5" rpy="0 0 0"/>
      <mass value="${m_wingsail}"/>
      <inertia ixx="${I_small}" ixy="0.0" ixz="0.0" iyy="${I_small}" iyz="0.0" izz="${I_small}"/>
    </inertial>
    <visual>
      <origin xyz="-0.05 -0.015 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/mainsail/mainsail.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Red"/>
    </visual>
    <collision>
      <origin xyz="-0.05 -0.015 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/mainsail/mainsail.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Rudder (revolute about vertical axis) -->
  <link name="rudder">
    <inertial>
      <origin xyz="0 0.08 -0.08" rpy="0 0 0"/>
      <mass value="${m_rudder}"/>
      <inertia ixx="${I_small}" ixy="0.0" ixz="0.0" iyy="${I_small}" iyz="0.0" izz="${I_small}"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/rudder/rudder.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/rudder/rudder.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- Keel as a single link with two mesh components (plate + bulb) -->
  <link name="keel">
    <inertial>
      <!-- Set the CoM where you expect the keel COM; adjust for your CAD -->
      <origin xyz="0.175 -0.55 0.1" rpy="1.570796 0 0"/>
      <mass value="${m_keel}"/>
      <inertia ixx="${m_keel*0.016}" ixy="0.0" ixz="0.0" iyy="${m_keel*0.016}" iyz="0.0" izz="${m_keel*0.016}"/>
    </inertial>

    <!-- Plate visual -->
    <visual>
      <!-- Align to plate’s CAD frame relative to keel link frame -->
      <origin xyz="0.175 -0.7 0.44" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>

    <!-- Bulb visual -->
    <visual>
      <!-- Align bulb mesh relative to keel link frame -->
      <origin xyz="0.135 -0.21 0.015" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
      <material name="Blue"/>
    </visual>

    <!-- Plate collision -->
    <collision>
      <origin xyz="0.175 -0.7 0.44" rpy="0 1.570796 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_plate.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>

    <!-- Bulb collision -->
    <collision>
      <origin xyz="0.135 -0.21 0.015" rpy="1.570796 0 0"/>
      <geometry>
        <mesh filename="package://mrg_modimoop_description/models/mrg_modimoop_base/keel/keel_bulb.STL" scale="${mesh_scale}"/>
      </geometry>
    </collision>
  </link>

  <!-- ===================== -->
  <!-- Joints                -->
  <!-- ===================== -->

  <!-- Keel fixed to hull -->
  <joint name="keel_mount" type="fixed">
    <parent link="hull"/>
    <child link="keel"/>
    <origin xyz="0 0 -0.1" rpy="0 0 0"/>
  </joint>

  <!-- Wingsail rotates around Z (trim). Limit range ±90° by default -->
  <joint name="wingsail_joint" type="revolute">
    <parent link="hull"/>
    <child link="wingsail"/>
    <origin xyz="0.2 -0.65 0.65" rpy="0 0 1.570796"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="20.0" velocity="1.5"/>
    <dynamics damping="0.2" friction="0.0"/>
  </joint>

  <!-- Rudder rotates around Z for yaw -->
  <joint name="rudder_joint" type="revolute">
    <parent link="hull"/>
    <child link="rudder"/>
    <origin xyz="0.175 -0.3 0.3" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-0.7854" upper="0.7854" effort="10.0" velocity="2.0"/>
    <dynamics damping="0.1" friction="0.0"/>
  </joint>

  <!-- HYDRODYNAMICS for hull -->
  <gazebo>
    <plugin filename="gz-waves1-hydrodynamics-system"
            name="gz::sim::systems::Hydrodynamics">
      <!-- required: which link carries this hydro model -->
      <enable>MODIMOOP::hull</enable>

      <hydrodynamics>
        <damping_on>0</damping_on>
        <viscous_drag_on>0</viscous_drag_on>
        <pressure_drag_on>0</pressure_drag_on>
      
        <!-- Linear and Angular Damping -->
        <cDampL1>1.0E-6</cDampL1>
        <cDampL2>1.0E-6</cDampL2>
        <cDampR1>1.0E-6</cDampR1>
        <cDampR2>1.0E-6</cDampR2>
      
        <!-- 'Pressure' Drag -->
        <cPDrag1>1.0E+2</cPDrag1>
        <cPDrag2>1.0E+2</cPDrag2>
        <fPDrag>0.4</fPDrag>
        <cSDrag1>1.0E+2</cSDrag1>
        <cSDrag2>1.0E+2</cSDrag2>
        <fSDrag>0.4</fSDrag>
        <vRDrag>1.0</vRDrag>
      </hydrodynamics>

    </plugin>
  </gazebo>
</robot>

